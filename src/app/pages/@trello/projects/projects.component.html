<page-header></page-header>

<page-body>
  <div class="row">
    <div class="col-xl-12">
      <ng-container *ngIf="trelloViewer.areProjectsLoaded(); else projectsLoading">
        <card>
          <card-header>
            <card-title>
              <h1> Manage Projects </h1>
            </card-title>

            <card-tools>
              <button class="btn" type="button" (click)="addTrelloProject()" data-bs-toggle="modal" data-bs-target="#manageProjectModal">
                <i class="fas fa-plus"></i>
                Add Project
              </button>

              <button class="btn" (click)="trelloViewer.syncAllProjects()">
                <i class="fas fa-sync"></i>
                Sync Project
              </button>
            </card-tools>
          </card-header>

          <card-body>
            <div class="row">
              <div class="col-xl-12">

                <ng-container *ngIf="trelloViewer.trelloProjects.length !== 0; else noProjects">

                  <div class="row">
                    <div class="col-xl-12 project-card">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Project Title</th>
                            <th>Members</th>
                            <th>Card Total</th>
                            <th>Sync Date</th>
                            <th></th>
                          </tr>
                        </thead>

                        <tbody>
                          <tr *ngFor="let aTrelloProject of trelloViewer.trelloProjects; index as i">
                            <td> {{aTrelloProject.projectName}} </td>

                            <td class="memberCells">
                              <img *ngFor="let aMember of aTrelloProject.projectMembers | slice:0:5; index as j" class="profilePicture" [src]="aMember.profilePicture" [attr.alt]="'Member ' + j">
                              <div class="additionalMembers" *ngIf="aTrelloProject.projectMembers.length > 5">
                                <p> +{{aTrelloProject.projectMembers.length - 5}} </p>
                              </div>
                            </td>

                            <td> {{aTrelloProject.trelloCards.length}} Cards </td>
                            <td> {{aTrelloProject.expiryDate | date: 'dd MMMM yyyy'}} </td>

                            <td>
                              <button class="btn btn-primary" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-h"></i>
                              </button>

                              <div class="dropdown-menu">
                                <button class="dropdown-item" (click)="editTrelloProject(i)" data-bs-toggle="modal" data-bs-target="#manageProjectModal">
                                  <i class="fas fa-edit"></i> Edit
                                </button>

                                <button class="dropdown-item" (click)="removeTrelloProject(i)" data-bs-toggle="modal" data-bs-target="#confirmationModal">
                                  <i class="fas fa-trash"></i> Remove
                                </button>

                                <div class="dropdown-divider"></div>

                                <button class="dropdown-item" (click)="exportCSVProject(i)" data-bs-toggle="modal" data-bs-target="#exportCSVProjectModal">
                                  <i class="fas fa-file-csv"></i> Export CSV
                                </button>

                                <button class="dropdown-item" (click)="exportLatexProject(i)" data-bs-toggle="modal" data-bs-target="#exportLatexProjectModal">
                                  <i class="fas fa-file-code"></i> Export LaTeX
                                </button>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>

                </ng-container>

                <ng-template #noProjects>
                  <trello-no-project></trello-no-project>
                </ng-template>
              </div>
            </div>
          </card-body>
        </card>
      </ng-container>

      <ng-template #projectsLoading>
        <trello-loading-projects [trelloViewer]="trelloViewer"></trello-loading-projects>
      </ng-template>
    </div>
  </div>
</page-body>

<trello-project [projectIndex]="projectIndex" [trelloForm]="trelloForm" [(trelloViewer)]="trelloViewer"></trello-project>

<trello-export-csv [projectIndex]="projectIndex" [trelloViewer]="trelloViewer"></trello-export-csv>

<trello-export-latex [projectIndex]="projectIndex" [trelloViewer]="trelloViewer"></trello-export-latex>

<confirmation-modal modalId="confirmationModal" (modalChoice)="confirmRemoveTrelloProject($event)"></confirmation-modal>
